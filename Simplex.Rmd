---
title: "KMI"
author: "Boyko Amarov"
date: "11/9/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Симплекс

Тема 3, задача 1

```{r}
library(ggplot2)
library(gMOIP)
library(gridExtra)
```

```{r}
ra1 <- c(2, 1)
ra2 <- c(1, 2)
Aa <- rbind(ra1, ra2)
ba <- c(10, 8) ## resources
obja <- c(5, 5)  # objective function coefficients

p3.1 <- plotPolytope(
   Aa,
   ba,
   obja,
   type = rep("c", ncol(Aa)),
   crit = "max",
   faces = rep("c", ncol(Aa)),
   plotFaces = TRUE,
   plotFeasible = TRUE,
   plotOptimum = TRUE,
   labels = "coord"
) + ggplot2::ggtitle("Тема 3, задача 1")
plot(p3.1)
```
$$
x_1: \text{светла бира (л.)}\\
x_2: \text{тъмна бира (л.)}\\
Ресурси: хмел, малц
$$

$$
\max Z(x) = 5x_1 + 5x_2\\
\\
2x_1 + x_2 \leq 10 \text{ Малц}\\
x_1 + 2x_2 \leq 8 \text{ Хмел}\\
x_1, x_2 \ge 0\\
$$

Каноничен вид
$$
\max Z(x) = 5x_1 + 5x_2\\
\\
2x_1 + x_2 +s_1 + 0s_2= 10 \text{ Малц}\\
x_1 + 2x_2 +0s_1 + s_2 = 8 \text{ Хмел}\\
x_1, x_2, s_1, s_2 \ge 0\\
$$
Имаме 2 уравнения и 4 променливи.
$$
2x_1 + x_2 +s_1= 10 \\
x_1 + 2x_2 +s_2 = 8 \\
$$
1) Започваме от някакво начално решение на системата уравнения: (0, 0, 10, 8)
Ако фиксираме 2 променливи, например $x_1$ и $x_2$.
$$
\text{Разглеждаме решение } (x_1 = 0, x_2 = 0, s_1 = 10, s_2 = 8)\\
s_1 = 10 - 2x_1 -x_2\\
s_2 = 8 - x_1 - 2x_2\\
\max Z(x) =5x_1 + 5x_2\\
\max Z(x) =0 - (-5x_1 -5x_2)\\
\vdots\\
s_1 = 10 - 2x_1\\
s_2 = 8 - x_1\\
$$
$$
\text{Нека } x_1 = 0, x_2 = 0\\
s_1 = 10 - 2*0 -0 = 10\\
s_2 = 8 - 0 - 2*0 = 8\\
Z(x) = 0
$$

1. Оптимален връх ли е (x_1 = 0, x_2 = 0, s_1 = 10, s_2 = 8)?
   -- Не, защото можем да увеличим x_1  с една единица и това ще увеличи печалбата (Z) с 5 (коеф. на x_1 в Z).
2) С колко най-много можем да увеличим x_1 (оставяме x_2 = 0)?
      -- Възможно ли е да увеличим x_1 на 10? Не, защото s_1 = -10, s_2 = -2 което не е допустимо решение.
   -- x_1 може да е най-много 5.
$$
s_1 = 10 - 2*10 -0 = -10\\
s_2 = 8 - 10 - 2*0 = -2\\
$$

$$
x_1 = 5, x_2 = 0,s_1 = 0, s_2 = 3\\
s_1 = 10 - 2*5 - 0 = 0\\
s_2 = 8 - 5 - 2*0 = 3\\
$$
Разглеждаме (допустимото решение/връх) (5, 0, 0, 3)

$$
\text{Разглеждаме връх } (x_1 = 5, x_2 = 0, s_1 = 0, s_2 = 3)\\
s_1 = 10 - 2x_1 -x_2\\
s_2 = 8 - x_1 - 2x_2\\
...\\
x_1 = ?\\
s_2 = ?\\
...\\
x_1 = 5 - \frac{1}{2}x_2 - \frac{1}{2}s1\\
s_2 = 3 - \frac{3}{2}x_2 + \frac{1}{2}s_1\\
\max Z(x_2, s_1) = 5(5 - \frac{1}{2}x_2 - \frac{1}{2}s1) + 5x_2\\
\max Z(x_2, s_1) = 25 + \frac{5}{2}x_2 - \frac{5}{2}s1\\
$$
$$
x_1 = 4, x_2 = 2, s_1 = 0, s_2 = 0\\
x_1 = 5 - \frac{2}{2} - 0 = 4\\
s_2 = 3 - \frac{3}{2}2 + 0 = 0\\
$$
$$
\text{Разглеждаме решение } (x_1 = 4, x_2 = 2, s_1 = 0, s_2 = 0)\\
x_1 = 5 - \frac{1}{2}x_2 - \frac{1}{2}s1\\
s_2 = 3 - \frac{3}{2}x_2 + \frac{1}{2}s_1\\
...\\
2x_1 = 10 - x_2 - s1\\
x_2 = 2 + \frac{1}{3}s_1 - \frac{2}{3}s2 \quad /(2r1 - r2)\\ \implies
2x_1 - x_2 = 10 -x_2 -s_1 - (2 + \frac{1}{3}s_1 - \frac{2}{3}s_2) \\ \implies
2x_1 = 8 - \frac{2}{3}s_1 + \frac{2}{3}s_2 \quad /:2 \implies\\
...\\
x_1 = 4 - \frac{2}{3}s_1 + \frac{1}{3}s_2\\
x_2 = 2 + \frac{1}{3}s_1 - \frac{2}{3}s2 \\

\max Z = 25 + \frac{5}{2}\left(2 + \frac{1}{3}s_1 - \frac{2}{3}s2\right) - \frac{5}{2}s1\\
\max Z = 30 - \frac{10}{6}s_1 - \frac{10}{6}s_2
$$

$$
s_1 = 10 - 2x_1 -x_2 \text{/ :2}\\
s_2 = 8 - x_1 - 2x_2\\
--\\
x_1 = 5 - 0.5x_2 - 0.5s_1 \\ 
s_2 = 8 - x_1  -2x_2\\
--\\
x_1 = 5 - 0.5x_2 - 0.5s_1 \\ 
s_2 = 8 - (5 - 0.5x_2 - 0.5s_1)  -2x_2\\
--\\
x_1 = 5 - 0.5x_2 - 0.5s_1 \\ 
s_2 = 3 - 1.5x_2 + 0.5s_1\\
--\\
Z = 5(5 - 0.5x_2 - 0.5s_1) + 5x_2\\
Z = 25 - 2.5x_2 -2.5s_1 + 5x_2\\
Z = 25 + 2.5x_2 -2.5s_1
$$
$$
\text{ Оптимален план (връх) ли е } x_1 = 5, x_2 = 0, s_1 = 0, s_2 = 3?
\text{ Не, защото кеоф. на } x_2 \text{ в } Z \text{ е положителен: 2.5}

$$
Търсим следващия план и ще го намерим като увеличим x_2 максимално много. Можем да го увеличим най-много до x_2 = 2 (при по-големи стойности s_2 става отрицателно, което
не е допустимо решение).

Следващият план ще е (x_1 = 4, x_2 = 2, s_1 = 0, s_2 = 0)

$$
x_1 = 5 - 0.5x_2 - 0.5s_1 \\ 
s_2 = 3 - 1.5x_2 + 0.5s_1\\
--\\
x_1 = 5 - 0.5x_2 - 0.5s_1 \\ 
x_2 = \frac{3}{1.5} - \frac{0.5}{1.5}s_1 - \frac{1}{1.5}s_2\\
--\\
x_1 = 5 - 0.5x_2 - 0.5s_1 \\ 
x_2 = 2 - 0.333s_1 - 0.66s_2\\
$$
## Домашно:
$$
x_1 = ?\\
x_2 = ? \\
Z = ?
$$

Каноничен вид:

$$
\max Z(x) = 5x_1 + 5x_2\\
2x_1 + x_2 + 1s_1 + 0s_2 = 10\\
x_1 + 2x_2 + 0s_1 + 1s_2 = 8\\
x_1, x_2, s_1, s_2 \ge 0\\
$$

Първоначален опорен план (връх на допустимото множество): (x_1 = 0, x_2 = 0, s_1 = 10, s_2 = 8)
$$
x_1 = 0, x_2 = 0, s_1 = 10, s_2 = 8 \implies Z(x) = 0
$$

$$
s_1 = 10 -2x_1 -x_2\\
s_2 = 8 -x_1 -2x_2\\
$$


















Избираме базово решение $(?, ?, ?, ?)$

$$
s_1 = 10 - 2x_1 - x_2\\
s_2 = 8 - x_2  - 2x_2\\
Z(x) = 5x_1 + 5x_2 + 0s_1 + 0s_2 = 0
$$

$$
x_1 = 5 -0.5x_2 -0.5s_1\\
s_2 =3 -1.5x_2 + 0.5s_1\\
Z = 
$$



## Задача 1 (таблици)

      x_1   x_2   x_3   x_4   a_0
x_3   2     1     1     0     10
x_4   1     2     0     1     8

Избираме x_2 да влезе в базиса на мястото x_4.

      x_1   x_2   x_3   x_4   a_0
x_3   2     1     1     0     10    (R1)
x_2   1     2     0     1     8     (R2)

В следващото табло искаме коефициентът пред x_3 в първото уравнение
да е 1, а коефициентът пред x_2 да е 0.

На ред 2 (x_2) искаме коеф. пред x_2 да е равен на 1, а коеф. пред
x_3 да е равен на 0.

1) R2 = R2 / 2

      x_1   x_2   x_3   x_4   a_0
x_3   2     1     1     0     10    (R1)
x_2   1/2   1     0     1/2   4     (R2)

2) R1 = R1 - R2

2 - 1/2 = 3/2
1 - 1 = 0
1 - 0 = 1
0 - 1/2 = -1/2
10 - 4 = 6

      x_1   x_2   x_3   x_4     a_0
x_3   3/2   0     1     -1/2    6     (R1)
x_2   1/2   1     0     1/2     4     (R2)

$$
\frac{3}{2}x_1 + 0x_2 + x_3 -\frac{1}{2}x_4 = 6\\
\frac{1}{2}x_1 + 1x_2 +0x_3 +\frac{1}{2}x_4 = 4\\
$$

$$
x_3 = 6 - \frac{3}{2}x_1 + \frac{1}{2}x_4\\
x_2 = 4 - \frac{1}{2}x_1 - \frac{1}{2}x_4\\
$$
Ако увеличим x_1 от 0 на 1, то x_3 трябва да намалее с 3/2, за да е изпълнено
уравнение 1. Ако x_1 са произведени литри светла бира и x_3 е количеството
неизползван за производство малц.

x_2: произведени литри тъмна бира. Въпрос: с колко литри трябва да намалее
x_2 (тъмна бира), ако увеличим производството на светла бира с 1 л.

В решението, което разглеждаме (x_1 = 0, x_2 = 4, x_3 = 6, x_4 = 0) няма 
неизползвано количество хмел (x_4 = 0). Всичката наличност на хмел (8 кг.)
се използва за производството на x_2 = 4 литра тъмна бира.

Ако искаме да увеличим производството на светла бира от 0 на 1 л., тогава
трябва да намалим производството на тъмна бира, за да освободим хмел. Колко
хмел ни трябва, за да произведем 1л. светла бира? Гледаме коеф. на x_1 във
второто уравнение (хмел): 1 кг. хмел за 1 л. светла бира.

За да произведем 1 л. светла бира трябва да се лишим от половин (1/2) л. тъмна бира, което ще освободи 2 * 1/2 = 1 кг. хмел.

Има ли смисъл да увеличаваме производството на светла бира?
Смисъл в случая означава увеличение на целевата функция (печалба).

Колко приходи ще ни донесе един допълнителен литър светла бира? Гледаме
коеф. на x_1 в целевата функция. В този пример тя ще се увеличи с 5 лв. за един допълнителн литър светла бира.

Този допълнителн литър светла бира е свързан (поради ограничението на хмела) с намалено производство на тъма бира (половин литър). С колко ще намалее
целевата функция поради по-малкото производство на тъмна бира? Коеф. на x_2 в целевата функция e 5 лв./л. Следователно печалбата (цел. функция) ще намалее с 5*1/2 = 2.5

$$
\Delta_1 = 5 * 1/2 - 5 = - 5/2
$$


## Тема 3: Задача 2


$$
\text{Разглеждаме решение} (0, 0, 16, 24)\\
\Delta_1 = 0* 1 + 0 * 3 - 6 = -6\\
\Delta_2 = 0* 2 + 0 * 2 - 4 = -4\\
\Delta_3 = \ldots\\
$$

$$
z(x) = 0 - (-6x_1 - 4 x_2)
$$
1) Ред 2 от втората симплекс таблица = Ред 2 / 3 (коеф. пред x_1)
2) Ред 1 от втората симплекс таблица = Ред 1 - (Ред 2) / 3

## Задача 4

$$
x_1 - x_3 = 1 -> \\
x_1 - x_3 + x_6 = 1;\\
x_6 \ge 0
$$

x_6: изкуствена променлива
$$
\max z(x) = -2x_1 - 3x_2 + 3x_3 - M*x_6\\
-2x_1 -x_2 + x_4 = 3\\
x_1 - x_3 + x_6 = 1\\
3x_1 +x_3 + x_5 = 4\\
x_1,\ldots,x_5,x_6 \ge 0\\
\vdots\\
(x_1 = 0, x_3 = 0, \ldots, x_6 = 1)???
$$
$$
\Delta_1 = 0 * (-2) + (-M) * 1 + 0 * 3 - (-2) = \\
-M + 2
$$







## Дуални задачи

$$
\max z(x) = x_1 + 6x_2\\
x_1 \leq 200 \quad (R1) \times y_1 \geq 0 \\
x_2 \leq 300 \quad (R2)\times y_2 \geq 0 \\
x_1 + x_2 \leq 400 \quad (R3)\times y_3\geq 0 \\
x_1,x_2 \geq 0\\

Решение\\
x^* = (100, 300)\\
z(x^*) = 100 + 6*300 = 1900
$$


$$
z(x) = x_1 + 6x_2 \leq 1900
$$

$$
x_1y_1 + y_2x_2 + x_1y_3 + x_2y_3 \leq 200y_1 + 300y_2 + 400y_3\\
z(x) \leq (y_1 + y_3)x_1 + (y_2 + y_3)x_2 \leq \underbrace{200y_1 + 300y_2 + 400y_3}_{\text{Горна граница на печалбата}}\\
y_1 + y_3 \geq 1\\
y_2 + y_3 \geq 6\\
$$
$$
\min 200y_1 + 300y_2 + 400y_3\\
y_1 + y_3 \geq 1\\
y_2 + y_3 \geq 6\\
y_1,y_2,y_3\geq 0
$$

## Пример към теорема 3

$$
z(x) = 2x_1 + 4x_2\\
g(y) = 9y_1 + 12y_2 + 10y_3\\

z(0, 2) = 8 = g(0, 0, 4/5) = 9*0 + 12*0 + 10*4/5 = 8\\
y_1 + 3y_2 + 10y_3\geq 2\\
3y_1 + 4y_2 + 5y_3 \geq 4\\
y_1, y_2, y_3 \geq 0
$$

$$
x_1: \text{ Литри светла бира}\\
x_2: \text{ Литри тъмна бира}\\

x_1 + x_2 \leq 400 \quad (Хмел (kg))\\
x_1 + 4x_2 \leq 700 \quad (Малц (kg))\\
\vdots\\
x_1 + x_2 + (x_3) = 401  \quad (Хмел (kg))\\
x_1 + 4x_2 + x_4 = 700 \quad (Малц (kg))\\
$$




